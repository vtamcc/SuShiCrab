{"version":3,"sources":["assets/SuShiCarb/scripts/Game/ShuShiCarb.Hook.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport Global from \"../ShuShiCarb.Global\";\nimport ShuShiCarbFood from \"./ShuShiCarb.Food\";\nimport ShuShiCarbPlayer from \"./ShuShiCarb.Player\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ShuShiCarbHook extends cc.Component {\n    public static instance: ShuShiCarbHook = null;\n    @property(cc.Node)\n    hookRope: cc.Node = null;\n\n    @property(cc.Node)\n    hookSpriteOpen: cc.Node = null;\n\n    @property(cc.Node)\n    hookSpriteClose: cc.Node = null;\n\n    @property(cc.Node)\n    hookHead: cc.Node = null;\n    \n    hookSpeed = 30;\n    hookState = 0;\n\n    hookHeadBaseY: number = 80;\n    hookRopeBaseWidth: number = 100;\n    \n    mousePos;\n    isClickable: boolean = true;\n    onLoad() {\n        ShuShiCarbHook.instance = this;\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);  \n        Global.speedHook = JSON.parse(cc.sys.localStorage.getItem(\"speedHook\")) || Global.speedHook;\n        Global.lengthHook = JSON.parse(cc.sys.localStorage.getItem(\"lengthHook\")) || Global.lengthHook;\n        console.log(\"speed \", Global.speedHook);\n    }\n\n\n    initHook()  {\n        this.hookHead.y  = this.hookHeadBaseY;\n        this.hookRope.width = this.hookRopeBaseWidth;\n    }\n\n    start() {\n        this.initHook();\n    }\n    setHookState(hookState) {\n        this.hookState = hookState;\n        console.log(\"hookState \",hookState);\n    }\n\n    setHookSprite(isOpen: boolean) {\n        this.hookSpriteClose.active = !isOpen;\n        this.hookSpriteOpen.active = isOpen;\n    }\n \n\n    onTouchEnd(event: cc.Event.EventTouch) {\n        if (!this.isClickable || this.hookState !== 0 || !ShuShiCarbPlayer.instace.isAtOrderPosition) {\n            return;\n        }\n        this.hookState = 1;\n        this.mousePos = this.node.parent.convertToNodeSpaceAR(cc.v2(event.getLocationX()));\n\n        console.log(this.mousePos); \n        this.node.setPosition(this.mousePos);\n    }\n\n    moveHookHead(dt) {\n        this.hookHead.y += dt * Global.speedHook;\n        this.hookRope.width += dt * Global.lengthHook;\n      \n    }\n    onDestroy() {\n        cc.Canvas.instance.node.off(cc.Node.EventType.MOUSE_DOWN, this.onTouchEnd, this);\n    }\n    update(dt) {\n        this.setHookSprite(true);\n        switch(this.hookState) {\n            case 1:\n                if(this.hookHead.y) {\n                    this.moveHookHead(Global.speedHook * dt);\n                    if(this.hookHead.y >= 600) {\n                        this.hookState = 2;\n                     \n                    }\n                }\n                break;\n            case 2:\n                if(this.hookHead.y) {\n                    this.moveHookHead(-Global.speedHook  * dt);\n                    this.hookHead.getComponent(cc.BoxCollider).enabled = false;\n                    if(this.hookHead.y  < 0) {\n                        this.hookHead.y = 100;\n                        this.hookRope.width = 100;\n                        this.hookState = 0;\n                        this.hookHead.getComponent(cc.BoxCollider).enabled = true;\n                        this.disableClickTemporarily(0.2);\n                    }\n                }\n               \n                this.setHookSprite(false);\n                break;\n            case 0:\n                default:\n                    break;\n        }\n    }\n\n    disableClickTemporarily(duration: number) {\n        this.isClickable = false;\n        this.scheduleOnce(() => {\n            this.isClickable = true;\n        }, duration);\n    }\n}"]}